// the semi-colon before function invocation is a safety net against concatenated
// scripts and/or other plugins which may not be closed properly.
(function(e,t,n,r){function o(t,n){this.element=t;this.settings=e.extend({},s,n);this._name=i;this._defaults=s;this.init();this.behaviour()}var i="khantrolKnob",s={range:270,css:"default",responsive:!1,moveBy:.1,minVal:0,maxVal:100,speed:1,scale:1,holdKey:!1,groupKey:!1,preHTML:""};o.prototype={init:function(){var n=e(this.element),r=this.settings.range,i=r/2,s=this.settings.css,o=this.settings.responsive;r===Infinity&&(i=0);n.wrap("<div class='khantrol-knob kk-"+s+"'>");var u=n.parent();u.prepend("<div class='kk-face'><div class='kk-movingFace'><div class='kk-hand'></div></div></div><canvas class='kk-progress'></canvas>");this.settings.extraHTML!==""&&u.prepend(this.settings.extraHTML);var a=u.find(".kk-face"),f=a.find(".kk-movingFace"),l=f.find(".kk-hand"),c={};u.append("<span class='kk-value'>"+this.settings.minVal+"</span>");f.css("position","relative").css("overflow","hidden").css("float","none").css("-webkit-transform","rotate("+ -i+"deg)").css("-moz-transform","rotate("+ -i+"deg)").css("-ms-transform","rotate("+ -i+"deg)").css("-o-transform","rotate("+ -i+"deg)").css("transform","rotate("+ -i+"deg)").data("degs",-i).data("value",0).data("md",!1).css("z-index","29");a.css("float","none");c=u.find(".kk-progress");c.css("position","absolute").css("top",0).css("left",0).css("width",0).css("z-index","0");if(this.settings.responsive){u.addClass("kk-fluid");u.find(".kk-face").css("height",u.find(".kk-face").width())}var h=f.innerWidth()/2-l.width()/2;l.css("position","absolute").css("left",h).css("height",f.height()/2);e(t).resize(function(){if(o){var e=f.innerWidth()/2-l.width()/2;u.find(".kk-face").css("height",u.find(".kk-face").width());l.css("left",e).css("height",f.height()/2)}});n.attr("value",this.settings.minVal);u.prepend(this.settings.preHTML);n.addClass("kk-original-elm")},behaviour:function(){function E(e,t){s.clickpos=t.pageY||t.originalEvent.targetTouches[0].pageY;s.focus=e;s.initdeg=e.data("degs");e.data("md",!0)}function S(e,n,r,u){var a;if(s.focus.data("md")||n||r){!n&&!r&&(a=e.pageY||e.originalEvent.targetTouches[0].pageY);u&&(o=7);var f=s.focus;if(n||r)f=i;var v=f.data("degs"),m=(s.clickpos-a)*h,y=m*w+s.initdeg;y<l&&y>c&&!n&&!r?v=y:y>l?v=l:y<c&&(v=c);if(n||r)n?v-w>c?v-=w:v=c:r&&(v+w<l?v+=w:v=l);v>c?t.parent().addClass("turned-on"):t.parent().removeClass("turned-on");f.data("degs",v).css("-webkit-transform","rotate("+v+"deg)").css("-moz-transform","rotate("+v+"deg)").css("-ms-transform","rotate("+v+"deg)").css("-o-transform","rotate("+v+"deg)").css("transform","rotate("+v+"deg)");var E=f.data("degs")+l,S=Math.round(E/g*b);console.log(d);S+=d*b;S/=b;f.data("value",S);f.trigger("change");f.parent().find(".khantrolKnob").trigger("change");!n&&!r&&(p=e.pageY||e.originalEvent.targetTouches[0].pageY);e.preventDefault()}}function x(){s.focus.data("md",!1);T()}function T(){o=.1}function N(e){s.holdKey=!0;i.parent().parent().addClass("holding")}function C(){s.groupKey=!0;i.parent().parent().addClass("holding")}function k(){s.groupKey=!1;i.parent().parent().removeClass("holding")}function L(){s.holdKey=!1;i.parent().parent().removeClass("holding")}function A(e){(s.holdKey===!0||s.groupKey)&&S(e,!1,!0)}function O(e){(s.holdKey===!0||s.groupKey)&&S(e,!0,!1)}var t=e(this.element),r=t.parent(),i=r.find(".kk-movingFace"),s={},o=this.settings.moveBy,u=this.settings.holdKey,a=this.settings.groupKey,f=this.settings.range,l=f/2,c=l*-1,h=this.settings.speed,p=0,d=this.settings.minVal,v=this.settings.maxVal,m=v-d,g=f/m,y=this.settings.scale,b=1/y;console.log("scale: "+y);console.log("range: "+m);var w=this.settings.range/(this.settings.maxVal-this.settings.minVal)*y;console.log("degScale: "+w);console.log("");s.clickpos=0;s.focus=t;s.holdKey=!1;s.groupKey=!1;s.initdeg=0;i.on("touchstart",function(t){E(e(this),t)});e(n).on("touchmove",function(e){S(e,!1,!1,!0)});e(n).on("touchend",function(e){x()});i.on("mousedown",function(t){e("body").addClass("kk-rotating");E(e(this),t)});e(n).on("mousemove",function(e){S(e,!1,!1)});e(n).on("mouseup",function(){x();e("body").removeClass("kk-rotating")});e(n).on("keydown",function(e){var t=e.keyCode||e.which;t===38?A(e):t===40&&O(e);if(t===u){N();e.preventDefault()}if(t===a){C();e.preventDefault()}});e(n).on("keyup",function(e){var t=e.keyCode||e.which;if(t===u){L();T()}if(t===a){k();T()}(t===38||t===40)&&T()});i.on("change",function(n){var r=e(this).data("value");t.attr("value",r);if(parseInt(e(this).parent().parent().find(".kk-value").html())!=r){r==v?t.trigger("max"):r==d&&t.trigger("min");t.trigger("change")}e(this).parent().parent().find(".kk-value").html(r)})}};e.fn[i]=function(t){return this.each(function(){e.data(this,"plugin_"+i)||e.data(this,"plugin_"+i,new o(this,t))})}})(jQuery,window,document);